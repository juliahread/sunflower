<!DOCTYPE html>
<html>
  <head>
    <title>Sunflower</title>
    <link rel="shortcut icon" type="image/png" href="/favicon.png"/>
    <style>
      html, body {
        width: 100%;
        height: 100%;
        padding: 0;
        margin: 0;
      }
      body {
        background-color: #000;
      }
      .frame {
        fill: none;
        stroke: #FFF;
      }
    </style>
    <meta charset="utf-8">
    <script src = "https://d3js.org/d3.v3.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script>
      "use strict";

      var num = 2618;
      var phi = (Math.sqrt(5)-1)/2;
      var rho = d3.range(0, num).map(function(i) {return Math.pow(i, phi);});
      var theta = d3.range(0, num).map(function(i) {return i * 2 * Math.PI * phi;});

      const polarToRect = function(r, t) {
        return [r * Math.cos(t), r*Math.sin(t)];
      }

      let counter = 0;

      $(document).ready(function() {
          var bezierLine = d3.svg.line()
              .x(function(d) { return d[0]; })
              .y(function(d) { return d[1]; })
              .interpolate("basis");

          var svg = d3.select("#bezier-demo")
              .append("svg")
              .attr("width", 300)
              .attr("height", 150);

          var clearLine = function() {
            svg.select('path')
               .remove();
          }

          var drawLine = function() {
            svg.append('path')
                .attr("d", bezierLine([[0, 40], [25, 70], [50, 100], [100, 50], [150, 20], [200, 130], [300, 120]]))
                .attr("stroke", "white")
                .attr("stroke-width", 1)
                .attr("fill", "none")
                .transition()
                    .duration(2000)
                    .attrTween("stroke-dasharray", function() {
                        var len = this.getTotalLength();
                        return function(t) { return (d3.interpolateString("0," + len, len + ",0"))(t) };
                    });
            window.setTimeout(clearLine, 2000);
          }

          var width = $(window).width(),
              height = $(window).height(),
              radius = Math.min(width, height) / 2 - 30;

          var svg = d3.select("body").append("svg")
              .attr("width", width)
              .attr("height", height)
            .append("g")
              .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

          const draw = function() {
            const addCircle = function(svg, cx, cy, r, color) {
              svg.append("circle")
                     .attr("cx", cx)
                     .attr("cy", cy)
                     .attr("r", r)
                     .style("fill", color)
            }

            let nextCircle = function() {
              if (counter < num) {
                let coords = polarToRect(rho[counter], theta[counter]);
                let x = 2.5*coords[0];
                let y = 2.5*coords[1];
                addCircle(svg, x, y, 3, "white");
              }
              else if (counter > (num + 50)){
                counter = -1;
                d3.select("svg").remove();
                svg = d3.select("body").append("svg")
                    .attr("width", width)
                    .attr("height", height)
                  .append("g")
                    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");
              }
              counter += 1;
            }
            window.setInterval(nextCircle, 1);
          }
          draw();

          // let indices = [...Array(num).keys()];
          // let circles = svg.selectAll("circle")
          //     .data(indices)
          //     .enter()
          //     .append("circle");
          //
          // circles.attr("cx", function(d) { return 2*polarToRect(rho[d], theta[d])[0]})
          //        .attr("cy", function(d) {return 2*polarToRect(rho[d], theta[d])[1]})
          //        .attr("r", function(d) {return 3})
          //        .style("fill", function(d) {return "white"})

          //drawLine();
          //window.setInterval(drawLine, 2000);
        });
    </script>
  </head>

  <body>
  </body>
</html>
